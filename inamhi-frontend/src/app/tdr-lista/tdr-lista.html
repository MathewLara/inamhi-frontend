<div class="page-container fade-in">
    <div class="header-flex">
        <div>
            <h2 class="titulo-principal"><i class="fas fa-file-alt me-2"></i>Gesti√≥n de TDRs</h2>
            <p class="text-muted">T√©rminos de Referencia y Procesos de Contrataci√≥n</p>
        </div>
        <button class="btn-crear" routerLink="/nuevo-tdr">
            <i class="fas fa-plus me-2"></i>Nuevo TDR
        </button>
    </div>

    <div class="card-tabla">
        <div *ngIf="cargando" class="text-center p-5">
            <p>‚è≥ Cargando datos...</p>
        </div>

        <div *ngIf="!cargando && tdrs.length > 0" class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>C√ìDIGO</th>
                        <th>OBJETO CONTRATACI√ìN</th>
                        <th>PRESUPUESTO</th>
                        <th>ESTADO</th>
                        <th style="min-width: 150px;">ACCIONES</th> 
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of tdrs">
                        <td class="fw-bold text-primary">{{ item.numero_tdr || item.codigo }}</td>
                        <td>{{ item.objeto_contratacion }}</td>
                        <td class="fw-bold text-success">
                            ${{ (item.presupuesto_referencial || 0) | number:'1.2-2' }}
                        </td>
                        
                        <td>
                            <span class="badge" [ngClass]="getClaseBadge(item.estado || item.nombre_estado)">
                                {{ getTextoEstado(item.estado || item.nombre_estado) }}
                            </span>
                        </td>

                        <td class="acciones-cell">
                            <div style="display: flex; gap: 8px;">
                                <button (click)="verTdr(item)" title="Ver" style="background: #003366; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                    üîç
                                </button>
                                <button (click)="editarTdr(item)" title="Editar" style="background: #ffc107; color: black; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                    ‚úèÔ∏è
                                </button>
                                <button (click)="eliminarTdr(item)" title="Eliminar" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div *ngIf="!cargando && tdrs.length === 0" class="text-center p-5 text-muted">
            <h5>No hay TDRs registrados</h5>
        </div>
    </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModalVer && tdrSeleccionado" (click)="cerrarModalVer()" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;">
    <div class="modal-content" (click)="$event.stopPropagation()" style="background: white; width: 90%; max-width: 600px; padding: 20px; border-radius: 8px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
            <h3>Detalle TDR: {{ tdrSeleccionado.numero_tdr }}</h3>
            <button (click)="cerrarModalVer()">X</button>
        </div>
        <p><b>Objeto:</b> {{ tdrSeleccionado.objeto_contratacion }}</p>
        <p><b>Presupuesto:</b> ${{ tdrSeleccionado.presupuesto_referencial }}</p>
    </div>
</div>